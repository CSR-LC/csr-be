swagger: "2.0"
info:
  version: "0.0.1"
  title: Be
  description: |
    The API provides CSR backend API.

basePath: /api/
schemes:
  - https
  - http
securityDefinitions:
  Bearer:
    type: apiKey
    name: Authorization
    in: header
consumes:
  - application/json
produces:
  - application/json

paths:
  /v1/login:
    post:
      description: 'Returns token for authorized User'
      tags:
        - Users
      operationId: Login
      consumes:
        - "application/json"
      parameters:
        - name: 'login'
          in: 'body'
          required: true
          description: 'Login Payload'
          schema:
            $ref: '#/definitions/LoginInfo'
      responses:
        200:
          description: Successful login
          schema:
            $ref: '#/definitions/LoginSuccessResponse'
        404:
          schema:
            type: string
          description: User not found
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
  /v1/users:
    post:
      summary: Register a new user.
      tags:
        - Users
      operationId: postUser
      parameters:
        - name: data
          in: body
          description: New user data.
          required: true
          schema:
            $ref: "#/definitions/UserRegister"
      responses:
        201:
          description: Created
          schema:
            $ref: "#/definitions/CreateUserResponse"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
  /v1/users/me:
    get:
      summary: Get the current user data.
      security:
        - Bearer: []
      tags:
        - Users
      operationId: getCurrentUser
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/GetUserResponse"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
    patch:
      summary: Edit selected fields of the current user.
      security:
        - Bearer: []
      tags:
        - Users
      operationId: patchUser
      consumes:
        - application/json
      parameters:
        - name: userPatch
          in: body
          description: The patch to apply to the user.
          required: true
          schema:
            $ref: "#/definitions/PatchRequest"
      responses:
        204:
          description: Success
        default:
          description: Unexpected error
          schema:
            $ref: "#/definitions/Error"
  /management/users/{userId}:
    parameters:
      - name: userId
        in: path
        required: true
        description: user id
        type: integer
    get:
      summary: Get user by ID
      tags:
        - Users
      operationId: GetUser
      responses:
        201:
          description: Success
          schema:
            $ref: "#/definitions/GetUserById"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
  /management/listUsers:
    get:
      summary: Get all users
      tags:
        - Users
      operationId: GetAllUsers
      responses:
        201:
          description: Success
          schema:
            $ref: "#/definitions/GetListUsers"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
  /v1/roles:
    get:
      summary: List all roles.
      tags:
        - Roles
      operationId: GetRoles
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/ListRoles"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
  /v1/management/users/{userId}/role:
    parameters:
      - name: userId
        in: path
        required: true
        description: user id
        type: integer
    post:
      security:
       - Bearer: []
      consumes:
        - application/json
      parameters:
        - name: data
          in: body
          description: Role to assign to user.
          required: true
          schema:
            $ref: "#/definitions/AssignRoleToUser"
      summary: Assign role to user
      tags:
        - Users
      operationId: AssignRoleToUser
      responses:
        200:
          description: Role has been assigned to user
          schema:
            $ref: "#/definitions/GetUserResponse"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
  /equipment/statuses:
    post:
      summary: Creating a new status.
      tags:
        - Status
      operationId: postStatus
      parameters:
        - name: name
          in: body
          description: Status Name
          required: true
          schema:
            $ref: "#/definitions/StatusName"
      responses:
        201:
          description: Status has been created
          schema: 
            $ref: "#/definitions/SuccessStatusOperationResponse" 
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
    get:
      summary: List all statuses.
      tags:
        - Status
      operationId: GetStatuses
      responses:
        201:
          description: Success
          schema:
            $ref: "#/definitions/ListStatuses"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
  /equipment/statuses/{statusId}:
    parameters:
      - name: statusId
        in: path
        required: true
        description: status id
        type: string
    get:
      summary: Get status by id
      tags:
        - Status
      operationId: GetStatus
      responses:
        201:
          description: Status has been created
          schema: 
            $ref: "#/definitions/SuccessStatusOperationResponse" 
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
    delete:
      summary: Delete status by id
      tags:
        - Status
      operationId: DeleteStatus
      responses:
        201:
          description: Status has been created
          schema: 
            $ref: "#/definitions/SuccessStatusOperationResponse" 
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"  
  /equipment/kinds:
    get:
      summary: Get all kinds.
      tags:
        - Kinds
      operationId: GetAllKinds
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/ListOfKinds"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
    post:
      summary: Create a new kind.
      tags:
        - Kinds
      operationId: CreateNewKind
      parameters:
        - name: name
          in: body
          description: Name of a kind
          required: true
          schema:
            $ref: "#/definitions/CreateNewKind"      
      responses:
        201:
          description: Success
          schema:
            $ref: "#/definitions/CreateNewKindResponse"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
  /equipment/kinds/{kindId}:
    parameters:
      - name: kindId
        in: path
        required: true
        description: kind id
        type: string
    get:
      summary: Get information about the kind of equipment by id.
      tags:
        - Kinds
      operationId: getKindByID
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/GetKindByIDResponse"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
    delete:
      summary: Delete kind of equipment from db by id.
      tags:
        - Kinds
      operationId: deleteKind
      responses:
        201:
          description: kind of equipment successfully deleted from db 
          schema:
            $ref: "#/definitions/DeleteKindResponse"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
    patch:
      summary: Edit equipment kind by id.
      tags:
        - Kinds
      operationId: PatchKind
      parameters:
        - name: patchTask
          in: body
          required: true
          schema:
            $ref: '#/definitions/PatchTask'
      responses:
        201:
          description: Success
          schema:
           $ref: "#/definitions/PatchKindResponse"
        default:
          description: Unexpected error
          schema:
            $ref: "#/definitions/Error"
  /v1/orders:
    get:
      tags:
        - Orders
      operationId: GetAllOrders
      security:
        - Bearer: [ ]
      responses:
        200:
          description: 'List of orders'
          schema:
            type: object
            properties:
              data:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/definitions/Order'
                  total:
                    type: integer
        default:
          description: 'Unexpected error'
          schema:
            $ref: '#/definitions/Error'
    post:
      tags:
        - Orders
      operationId: CreateOrder
      security:
        - Bearer: [ ]
      consumes:
        - application/json
      responses:
        201:
          description: 'Order created'
          schema:
            $ref: '#/definitions/Order'
      parameters:
        - name: data
          in: body
          description: 'Create new order'
          required: true
          schema:
            $ref: '#/definitions/OrderCreateRequest'
  /v1/orders/{orderId}:
    put:
      summary: Edit order by id
      tags:
        - Orders
      security:
        - Bearer: [ ]
      operationId: UpdateOrder
      parameters:
        - name: orderId
          in: path
          required: true
          description: order id
          type: integer
        - name: data
          in: body
          description: Edit order
          required: true
          schema:
            $ref: "#/definitions/OrderUpdateRequest"
      responses:
        200:
          description: Order updated
          schema:
            $ref: "#/definitions/Order"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
  /v1/order_statuses/{orderId}:
    get:
      summary: Get full order status history.
      tags:
        - Orders
      security:
        - Bearer: [ ]
      parameters:
        - name: orderId
          in: path
          required: true
          description: order id
          type: integer
      operationId: GetFullOrderHistory
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/OrderStatuses"
        404:
          description: Order not found
          schema:
            type: string
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
  /v1/order_statuses/:
    post:
      summary: Add new order status to order status history.
      tags:
        - Orders
      security:
        - Bearer: [ ]
      parameters:
        - name: data
          in: body
          description: 'Create new order status'
          required: true
          schema:
            $ref: '#/definitions/NewOrderStatus'
      operationId: AddNewOrderStatus
      responses:
        200:
          description: Order created
          schema:
            type: string
        default:
          description: Unexpected error.
          schema:
            $ref: '#/definitions/Error'
  /v1/orders/status/{status}:
    get:
      summary: Get orders by status.
      tags:
        - Orders
      security:
        - Bearer: [ ]
      parameters:
        - name: status
          in: path
          required: true
          description: order status
          type: string
      operationId: GetOrdersByStatus
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/OrderList"
        404:
          description: No orders found
          schema:
            type: string
        default:
          description: Unexpected error.
          schema:
            $ref: '#/definitions/Error'
  /v1/orders/from={fromDate}&to={toDate}&status={statusName}:
    get:
      summary: Get orders by date and status.
      tags:
        - Orders
      security:
        - Bearer: [ ]
      parameters:
        - name: fromDate
          in: path
          required: true
          type: string
          format: date
        - name: toDate
          in: path
          required: true
          type: string
          format: date
        - name: statusName
          in: path
          required: true
          type: string
      operationId: GetOrdersByDateAndStatus
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/OrderList"
        404:
          description: No orders found
          schema:
            type: string
        default:
          description: Unexpected error.
          schema:
            $ref: '#/definitions/Error'
  /v1/status_names:
    get:
      summary: Get all status names.
      tags:
        - Orders
      security:
        - Bearer: [ ]
      operationId: GetAllStatusNames
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/OrderStatusNames"
        default:
          description: Unexpected error.
          schema:
            $ref: '#/definitions/Error'
  /v1/active_areas:
    get:
      summary: Get all active areas.
      tags:
        - Active_Areas
      operationId: GetAllActiveAreas
      responses:
        200:
          description: Success
          schema:
            $ref: "#/definitions/ListOfActiveAreas"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
  /equipment:
    post:
      summary: Register a new equipment
      tags:
        - Equipment
      operationId: CreateNewEquipment
      consumes:
        - application/json
      parameters:
        - name: newEquipment
          in: body
          description: Create a new equipment
          required: true
          schema:
            $ref: "#/definitions/Equipment"
      responses:
        201:
          description: Equipment created
          schema:
            $ref: "#/definitions/EquipmentResponse"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
    get:
      summary: Get all equipment
      tags:
        - Equipment
      operationId: GetAllEquipment
      responses:
        201:
          description: Success
          schema:
            $ref: "#/definitions/ListEquipment"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"

  /equipment/{equipmentId}:
    parameters:
      - name: equipmentId
        in: path
        required: true
        description: equipment id
        type: string
    get:
      summary: Get equipment by id
      tags:
        - Equipment
      operationId: GetEquipment
      responses:
        201:
          description: Equipment has been found
          schema:
            $ref: "#/definitions/Equipment"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
    delete:
      summary: Delete equipment by id
      tags:
        - Equipment
      operationId: DeleteEquipment
      responses:
        201:
          description: Equipment has been deleted
          schema:
            $ref: "#/definitions/Equipment"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
    put:
      summary: Edit equipment by id
      tags:
        - Equipment
      operationId: EditEquipment
      parameters:
        - name: EditEquipment
          in: body
          description: Edit an equipment
          required: false
          schema:
            $ref: "#/definitions/Equipment"
      responses:
        201:
          description: Equipment edited
          schema:
            $ref: "#/definitions/Equipment"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
  /findEquipment:
    post:
      summary: Equipment filtered list
      tags:
        - Equipment
      operationId: FindEquipment
      parameters:
        - name: FindEquipment
          in: body
          description: Filtered list of an equipment
          required: false
          schema:
            $ref: "#/definitions/Equipment"
      responses:
        201:
          description: Equipment has been found
          schema:
            $ref: "#/definitions/ListEquipment"
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
  /v1/managment/users/{userId}/block:
    parameters:
      - name: userId
        in: path
        required: true
        description: user id
        type: integer 
    post: 
      summary: Block user
      tags:
        - Users
      operationId: blockUser
      responses:
        200:
          description: Success
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"
  /v1/managment/users/{userId}/unblock:
    parameters:
      - name: userId
        in: path
        required: true
        description: user id
        type: integer 
    post: 
      summary: Unblock user
      tags:
        - Users
      operationId: unblockUser
      responses:
        200:
          description: Success
        default:
          description: Unexpected error.
          schema:
            $ref: "#/definitions/Error"  

definitions:
  Error:
    type: object
    required:
      - data
    properties:
      data:
        type: object
        properties:
          correlationId:
            type: string
          message:
            type: string
  PatchTask:
    type: object
    required:
      - data  
    description: Patch task object (adding max reservation time and max reservation units)
    properties:
      data:
        type: object
        properties:
          max_reservation_time:
            type: integer
            description: max reservation time field
          max_reservation_units:
            type: integer
            description: max reservation units field

  PatchRequest:
    type: array
    items:
      $ref: "#/definitions/PatchItem"
  PatchItem:
    type: object
    description: A JSONPatch document as defined by RFC 6902
    required:
      - op
      - path
    properties:
      from:
        description: A string containing a JSON Pointer value
        type: string
      op:
        description: The operation to be performed
        enum:
          - add
          - remove
          - replace
          - move
          - copy
          - test
        type: string
      path:
        description: A JSON-Pointer
        type: string
      value:
        description: The value to be used within the operations
        type: object

  # User
  LoginInfo:
    type: object
    required:
      - login
      - password
    properties:
      login:
        type: string
      password:
        type: string
  LoginSuccessResponse:
    type: object
    required:
      - data
    properties:
      data:
        type: object
        required:
          - token
        properties:
          token:
            type: string
  UserEmbeddable:
    type: object
    required:
      - id
      - name
    properties:
      id:
        type: integer
      name:
        type: string
  User:
    type: object
    required:
      - id
      - createTime
      - roleId
      - login
    properties:
      id:
        type: integer
      login:
        type: string
      createTime:
        type: string
        format: date-time
      roleId:
        type: integer
  UserRegister:
    type: object
    required:
      - login
      - password
      - type
    properties:
      login:
        type: string
        minLength: 3
      password:
        type: string
        minLength: 6
      email:
        type: string
        format: email
      type:
        type: string
        enum:
          - person
          - organization
      name:
        type: string
      surname:
        type: string
      patronymic:
        type: string
      passport_series:
        type: string
      passport_number:
        type: string
      passport_authority:
        type: string
      passport_issue_date:
        type: string
        format: date
      phone_number:
        type: string
      org_name:
        type: string
      website:
        type: string
      vk:
        type: string
      active_areas:
        type: array
        items:
          type: integer
  CreateUserResponse:
    type: object
    required:
      - data
    properties:
      data:
        type: object
        required:
          - id
          - login
        properties:
          id:
            type: integer
          login:
            type: string
  GetUserResponse:
    type: object
    required:
      - data
    properties:
      data:
        $ref: "#/definitions/User"
  AssignRoleToUser:
    type: object
    required:
      - roleId
    properties:
      roleId:
        type: integer
  GetUserById:
    type: object
    required:
      - id
      - login
      - role
      - surname
      - name
      - patronymic
      - passport_series
      - passport_number
      - passport_authority
      - passport_issue_date
      - phone_number
      - email
      - is_blocked
      - type
      - org_name
    properties:
      id:
        type: integer
      login:
        type: string
      role:
        type: object
        properties:
          id:
            type: integer
          name:
            type: string
      surname:
        type: string
      name:
        type: string
      patronymic:
        type: string
      passport_series:
        type: string
      passport_number:
        type: string
      passport_authority:
        type: string
      passport_issue_date:
        type: string
      phone_number:
        type: string
      email:
        type: string
      is_blocked:
        type: boolean
        example: false
      type:
        type: string
      org_name:
        type: string

  GetListUsers:
    type: array
    items:
      $ref: "#/definitions/GetUserById"

  #Role
  Role:
    type: object
    required:
      - id
      - name
      - slug
    properties:
      id:
        type: integer
      name:
        type: string
      slug:
        type: string
  ListRoles:
    type: array
    items:
      $ref: "#/definitions/Role"

  #Status
  Status:
    type: object
    required:
      - id
      - name
    properties:
      id:
        type: string
      name:
        type: string
  ListStatuses:
    type: array
    items:
      $ref: "#/definitions/Status"
  SuccessStatusOperationResponse:
    type: object
    required:
      - data 
    properties:
      data:
        $ref: "#/definitions/Status"
  StatusName:          
    type: object
    required: 
      - name
    properties:
      name: 
        type: string
  # Kind
  Kind:
    type: object
    required:
      - name
    properties:
      id:
        type: integer
      name:
        type: string
      max_reservation_time:
        type: integer
      max_reservation_units:
        type: integer
  ListOfKinds:
    type: array
    items:
     $ref: "#/definitions/Kind"
  GetKindByIDResponse:
    type: object
    required:
      - data
    properties:
      data:
        $ref: "#/definitions/Kind"
  DeleteKindResponse:
   type: object
   required:
    - data
   properties:
    data:
      $ref: "#/definitions/Kind"
  CreateNewKind:
   type: object  
   required:
    - data
   properties:
    data:
      $ref: "#/definitions/Kind"    
  CreateNewKindResponse:
   type: object  
   required:
    - data
   properties:
    data:
      $ref: "#/definitions/Kind"
  PatchKindResponse:
   type: object  
   required:
    - data
   properties:
    data:
      $ref: "#/definitions/Kind"

  #Active Areas
  ActiveArea:
    type: object
    required:
      - id
      - name
    properties:
      id:
        type: integer
      name:
        type: string
  ListOfActiveAreas:
    type: array
    items:
     $ref: "#/definitions/ActiveArea"
  # Equipment
  Equipment:
    type: object
    required:
      - sku
      - name
      - kind
      - status
      - rate_hour
      - rate_day
      - location
      - description
      - photo
    properties:
      sku:
        type: string
        example: "ABC012345678"
      name:
        type: string
        example: "Dog harness 3000"
      kind:
        type: integer
        example: 5
      status:
        type: integer
        example: 1
      rate_hour:
        type: integer
      rate_day:
        type: integer
      location:
        type: integer
        example: 71
      description:
        type: string
        example: "This is a dog harness.\nWARNING: do not put on cats!"
      photo:
        type: string
        example: "https://..."
  EquipmentResponse:
    type: object
    required:
      - id
      - sku
      - name
      - kind
      - status
      - rate_hour
      - rate_day
      - location
      - description
      - photo
    properties:
      id:
        type: string
        example: 2
      sku:
        type: string
        example: "ABC012345678"
      name:
        type: string
        example: "Dog harness 3000"
      kind:
        type: integer
        example: 5
      status:
        type: integer
        example: 1
      rate_hour:
        type: integer
      rate_day:
        type: integer
      location:
        type: integer
        example: 71
      description:
        type: string
        example: "This is a dog harness.\nWARNING: do not put on cats!"
      photo:
        type: string
        example: "https://..."
  ListEquipment:
    type: array
    items:
      $ref: "#/definitions/EquipmentResponse"

  # Order
  OrderCreateRequest:
    type: object
    required:
      - description
      - quantity
      - rent_start
      - rent_end
      - equipment
    properties:
      description:
        type: string
      quantity:
        type: integer
        minimum: 1
      rent_start:
        type: string
        format: date-time
      rent_end:
        type: string
        format: date-time
      equipment:
        type: integer
        minimum: 1
  OrderUpdateRequest:
    type: object
    required:
      - description
      - quantity
      - rent_start
      - rent_end
    properties:
      description:
        type: string
      quantity:
        type: integer
        minimum: 1
      rent_start:
        type: string
        format: date-time
      rent_end:
        type: string
        format: date-time
  Order:
    type: object
    required:
      - id
      - description
      - quantity
      - rent_start
      - rent_end
      - user
      - equipment
      - last_status
    properties:
      id:
        type: integer
      description:
        type: string
      quantity:
        type: integer
      rent_start:
        type: string
        format: date-time
      rent_end:
        type: string
        format: date-time
      user:
        type: object
        $ref: '#/definitions/UserEmbeddable'
      equipment:
        type: object
        $ref: '#/definitions/Equipment'
      last_status:
        type: object
        $ref: '#/definitions/OrderStatus'
  OrderStatuses:
    type: array
    items:
      $ref: '#/definitions/OrderStatus'
  OrderStatus:
    type: object
    required:
      - id
      - comment
      - status
      - created_at
      - changed_by
      - order_id
    properties:
      id:
        type: integer
      comment:
        type: string
      status:
        type: string
      created_at:
        type: string
        format: date-time
      changed_by:
        type: object
        $ref: '#/definitions/UserEmbeddable'
      order_id:
        type: integer
  OrderList:
    type: array
    items:
      $ref: "#/definitions/Order"
  # Order Status
  NewOrderStatus:
    type: object
    required:
      - comment
      - status
      - created_at
      - order_id
    properties:
      comment:
        type: string
      status:
        type: string
      created_at:
        type: string
        format: date-time
      order_id:
        type: integer
  OrderStatusNames:
    type: array
    items:
      $ref: '#/definitions/OrderStatusName'
  OrderStatusName:
    type: object
    required:
      - id
      - name
    properties:
      id:
        type: integer
      name:
        type: string